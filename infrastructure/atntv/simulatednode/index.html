<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulted Node Data</title>
</head>

<script type="module">
    import simulateDay from "/infrastructure/atntv/simulatednode/simulateDay.js"
    import * as d3 from "https://d3js.org/d3.v7.min.js";
    import plotMainGraph from "/infrastructure/atntv/simulatednode/plotMainGraph.js";

    const configObj = {alpha: 1/3};

    const wsObj = {};

    const dataArrObj = {
        dataArr: [], 
        eventArr: [], 
        barcodeArr:[], 
        varianceArr:[],
        seatHistoryArr:[],
        isVisible:false, 
        wasVisible:false
    }

    const handler = {
        get(target, property) {
            if (property === 'push') {
                return (...args) => {
                    Array.prototype.push.apply(target.dataArr, args);
                    const oldChart = document.getElementById("chart")
                    oldChart.replaceWith(plotMainGraph(target.dataArr, target.eventArr, target.barcodeArr, target.varianceArr));
                };
            }
            return Reflect.get(target, property);
        },
    };
    const proxiedDataArrObj = new Proxy(dataArrObj, handler);

    window.handleSimulateFormSubmission = (event) => simulateDay(event, configObj, wsObj, proxiedDataArrObj)
    window.toggleLogs = (event) => {
        const logsContainer = document.getElementById("logsContainer")
        event.target.classList.toggle('active');
            if (event.target.classList.contains('active')) {
                event.target.textContent = 'Hide logs';
                logsContainer.style.display = "flex"
            } else {
                event.target.textContent = 'Show logs';
                logsContainer.style.display = "none"
            }
    }
</script>

<body>
    <div style="padding: 1vw; background-color: #ede9cc;">
        <h1>Simulted Node Data</h1>
    </div>
    <form>
        <div style="display: flex; flex-direction: row; margin: 1vw; margin-left: 0; max-height: 3vh;">
            <label for="dayDropdown" style="padding-right: 1vw;">Day to simulate: </label>
            <select id="dayDropdown" name="day">
                <option value="" selected disabled>Select an option</option>
                <option value="22">22/01/24</option>
                <option value="23">23/01/24</option>
                <option value="24">24/01/24</option>
                <option value="25">25/01/24</option>
                <option value="26">26/01/24</option>
                <option value="27">27/01/24</option>
                <option value="28">28/01/24</option>
            </select>

            <label for="startTime" style="padding: 0 1vw 0 4vw;">Start time:</label>
            <input type="time" id="startTime" name="startTime" value="08:00">

            <label for="endTime" style="padding: 0 1vw 0 4vw;">End time:</label>
            <input type="time" id="endTime" name="endTime" value="08:00">

            <label for="seat" style="padding: 0 1vw 0 4vw;">Seat:</label>
            <input type="text" style="max-width: 5vw;" id="seat" name="seat">

            <label for="speed" style="padding: 0 1vw 0 4vw;">Speed:</label>
            <input type="number" style="max-width: 5vw;" id="speed" name="speed" value="1">
        </div>
        <button style="margin-bottom: 1vw; width:5vw; background-color: #d6edcc;" type="submit" onclick="handleSimulateFormSubmission(event)">Go!</button>
    </form>
    <div id='options'>
        <div display="flex">
            <button id="toggleButton" onClick="toggleLogs(event)" style="margin-bottom: 1vw">Show logs</button>
        </div>
    </div>
    
    <div style="display: flex; flex-direction: row;">
        <div id="logsContainer" style="display: none;">
            <div id="datacontainer" style="height: 80vh; overflow: scroll; padding: 1vw; background-color: #ede9cc; max-width: 10vw;">
                <h3>Node readings</h3>
                <div id="data"></div>
            </div>
            <div id="lectureEventsContianer" style="height: 80vh; overflow: scroll; padding: 1vw; margin-left: 1vw; background-color: #EDCDCC; max-width: 10vw;">
                <h3>Lecture events</h3>
                <div id="lectureEvents"></div>
            </div>
        </div>
        <div style="display:flex; max-width: 80vw; margin-left: 1vw;">
            <div id="chartContainer" style="height: 75vh;">
                <div id="chart"></div>
            </div>
            <div id="seatDiagramContainer" style="height: 75vh;">
                <div id="seatDiagram"></div>
            </div>
        </div>
    </div>


</body>
</html>